<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>TBOOX</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="http://tboox.org/cn/page6/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX" href="http://tboox.org /feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?162f1cd478898a0686b0b5d5115e2af2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/cn" class="brand">TBOOX</a>
        <small>欢迎来到TBOOX开源工程!</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>English
                    </a>
                </li>

                
                    
                    
                    <li>
                        
                        <a href="/cn/project/">
                        
                            <i class="fa fa-bookmark"></i>项目
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                        <a href="/cn/archive/">
                        
                            <i class="fa fa-archive"></i>归档
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                        <a href="/cn/category/">
                        
                            <i class="fa fa-th-list"></i>分类
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                        <a href="/cn/tag/">
                        
                            <i class="fa fa-tags"></i>标记
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                        <a href="/cn/donation/">
                        
                            <i class="fa fa-heart"></i>捐助
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                        <a href="/cn/about/">
                        
                            <i class="fa fa-user"></i>关于
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index="">
    <div class="left">
        <h1>TBOOX开源工程</h1>
        <small>专注于跨平台c开发解决方案</small>
        <hr />
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/02/04/stream-zip/">通过流进行解压缩文件</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-02-04
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tbox" title="Category: tbox" rel="category">tbox</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#tbox" title="Tag: tbox" rel="tag">tbox</a>&nbsp;
    
        <a href="/tag/#c" title="Tag: c" rel="tag">c</a>&nbsp;
    
        <a href="/tag/#stream" title="Tag: stream" rel="tag">stream</a>&nbsp;
    
        <a href="/tag/#流" title="Tag: 流" rel="tag">流</a>&nbsp;
    
        <a href="/tag/#解压缩" title="Tag: 解压缩" rel="tag">解压缩</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <p>这里为了使代码更加简洁，直接用了transfer来挂接两路流的传输操作。</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code>    <span class="c1">// 初始化文件输入流
</span>    <span class="n">tb_stream_ref_t</span> <span class="n">istream</span> <span class="o">=</span> <span class="n">tb_stream_init_from_url</span><span class="p">(</span><span class="s">"/home/file.txt"</span><span class="p">);</span>

    <span class="c1">// 初始化文件输出流
</span>    <span class="n">tb_stream_ref_t</span> <span class="n">ostream</span> <span class="o">=</span> <span class="n">tb_stream_init_from_file</span><span class="p">(</span><span class="s">"/home/file.gz"</span><span class="p">,</span> <span class="n">TB_FILE_MODE_RW</span> <span class="o">|</span> <span class="n">TB_FILE_MODE_CREAT</span> <span class="o">|</span> <span class="n">TB_FILE_MODE_BINARY</span> <span class="o">|</span> <span class="n">TB_FILE_MODE_TRUNC</span><span class="p">);</span>

    <span class="c1">// 初始化解压缩流，以istream作为输入
</span>    <span class="n">tb_stream_ref_t</span> <span class="n">fstream</span> <span class="o">=</span> <span class="n">tb_stream_init_filter_from_zip</span><span class="p">(</span><span class="n">istream</span><span class="p">,</span> <span class="n">TB_ZIP_ALGO_GZIP</span><span class="p">,</span> <span class="n">TB_ZIP_ACTION_INFLATE</span><span class="p">);</span>

    <span class="c1">// 初始化压缩流，以istream作为输入
</span>    <span class="c1">//tb_stream_ref_t fstream = tb_stream_init_filter_from_zip(istream, TB_ZIP_ALGO_GZIP, TB_ZIP_ACTION_DEFLATE);    
</span>
    <span class="c1">// 进行流传输，并且通过 fstream进行中间外挂解压、压缩
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">istream</span> <span class="o">&amp;&amp;</span> <span class="n">ostream</span> <span class="o">&amp;&amp;</span> <span class="n">fstream</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="cm">/* 保存流数据，如果每个流都还没有调用tb_stream_open打开过
         * 这里会自动帮你打开，这样上层接口使用上，看上去更加简洁明了
         * 
         * 后面三个参数主要用于：限速、进度信息回调，这些之后再详细说明
         * 现在只需要传空就行了
         *
         * save 是 实际传输的数据大小，失败返回：-1
         */</span>
        <span class="n">tb_hong_t</span> <span class="n">save</span> <span class="o">=</span> <span class="n">tb_transfer_done</span><span class="p">(</span><span class="n">fstream</span><span class="p">,</span> <span class="n">ostream</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tb_null</span><span class="p">,</span> <span class="n">tb_null</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 释放流数据
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">fstream</span><span class="p">)</span> <span class="n">tb_stream_exit</span><span class="p">(</span><span class="n">fstream</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">istream</span><span class="p">)</span> <span class="n">tb_stream_exit</span><span class="p">(</span><span class="n">istream</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ostream</span><span class="p">)</span> <span class="n">tb_stream_exit</span><span class="p">(</span><span class="n">ostream</span><span class="p">);</span>
</code></pre>
</div>

                </div>
                <div class="read-all">
                    <a href="/cn/2016/02/04/stream-zip/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/02/04/smallest-compile/">tbox的裁剪和定制化编译</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-02-04
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tbox" title="Category: tbox" rel="category">tbox</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#tbox" title="Tag: tbox" rel="tag">tbox</a>&nbsp;
    
        <a href="/tag/#c" title="Tag: c" rel="tag">c</a>&nbsp;
    
        <a href="/tag/#裁剪" title="Tag: 裁剪" rel="tag">裁剪</a>&nbsp;
    
        <a href="/tag/#编译" title="Tag: 编译" rel="tag">编译</a>&nbsp;
    
        <a href="/tag/#配置" title="Tag: 配置" rel="tag">配置</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <p>默认编译出来的tbox库，支持的功能比较全，带有所有模块，并且支持ssl（依赖polarssl/openssl）、gzip（依赖zlib）、database（依赖sqlite3/mysql）。</p>

<p>因此生成的库文件偏大，而且会依赖三个第三方库，如果你用不到上述三个模块，完全可以自己配置编译所需要的模块，减小生成库的大小。</p>

<p>新版采用xmake进行构建，裁剪模块已经是相当方便了，默认情况下回去自动检测依赖的第三方库进行编译。</p>

<p>如果要禁用某个第三方库或者模块，只要执行<code class="highlighter-rouge">xmake f --xxxx=false</code>就行了，所有第三方库依赖都是可选，完全可以禁用。。</p>

<p>例如，禁用所有第三方库支持：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>    xmake f --polarssl<span class="o">=</span><span class="nb">false</span> --sqlite3<span class="o">=</span><span class="nb">false</span> --openssl<span class="o">=</span><span class="nb">false</span> --mysql<span class="o">=</span><span class="nb">false</span> --zlib<span class="o">=</span><span class="nb">false</span>
</code></pre>
</div>

<p>如果要最小化编译，可以禁用所有可选模块和特性：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>    xmake f --network<span class="o">=</span><span class="nb">false</span> --asio<span class="o">=</span><span class="nb">false</span> --charset<span class="o">=</span><span class="nb">false</span> --xml<span class="o">=</span><span class="nb">false</span> --database<span class="o">=</span><span class="nb">false</span> --zip<span class="o">=</span><span class="nb">false</span> --thread<span class="o">=</span><span class="nb">false</span>
</code></pre>
</div>

<p>tbox中使用float相关的代码，也是可以裁剪掉的，并且tbox还提供了一整套fixed16、fixed30、fixed6的定点运算库，来应付一些需要float运算的地方</p>


                </div>
                <div class="read-all">
                    <a href="/cn/2016/02/04/smallest-compile/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/02/04/platform-thread-pool/">线程池的使用</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-02-04
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tbox" title="Category: tbox" rel="category">tbox</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#tbox" title="Tag: tbox" rel="tag">tbox</a>&nbsp;
    
        <a href="/tag/#c" title="Tag: c" rel="tag">c</a>&nbsp;
    
        <a href="/tag/#线程池" title="Tag: 线程池" rel="tag">线程池</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <p>TBOX的线程池通过在每个worker中批量一次拉取多个task，对锁的竞争进行了优化。</p>

<p>由于每个task的函数实现不会太多，所以可以根据每个task的函数地址做hash，统计出每个task执行所花费的平均时间。然后根据这个平均值来动态计算每个worker一次拉取的task的数量，TBOX里面默认每个worker一次拉取10s的task量，这样可以尽可能的避免worker间锁的频繁抢占。</p>

<p>所有从等待队列被拉取出来的task，都会被放到pending队列中去，如果等待队列中的task都被取完了，某个worker处于了空闲状态，就会尝试去pending中，重新拉取其他worker还没有执行到的task， 这样可以解决某些task耗时太长，将worker中剩余的task阻塞住的问题。</p>

<p>重新从pending队列中拉取其他worker的task，并没有通过锁来维护，而是通过原子操作判断task的状态来维护的，所以性能上还是可以保证的。</p>

<p>整个线程池，只用到了一个锁来维护内部的几个队列，每个worker在大部分情况都是独立运行的，只有在自己的所有task都执行完空闲时，才回去全局等待队列中取task，并且上层接口也提供了批量投递任务的接口，来最小化对锁的使用。</p>

<p>下面看下简单的使用例子：</p>


                </div>
                <div class="read-all">
                    <a href="/cn/2016/02/04/platform-thread-pool/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/02/04/platform-exception/">用c实现跨平台异常捕获机制</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-02-04
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tbox" title="Category: tbox" rel="category">tbox</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#tbox" title="Tag: tbox" rel="tag">tbox</a>&nbsp;
    
        <a href="/tag/#c" title="Tag: c" rel="tag">c</a>&nbsp;
    
        <a href="/tag/#跨平台" title="Tag: 跨平台" rel="tag">跨平台</a>&nbsp;
    
        <a href="/tag/#异常捕获" title="Tag: 异常捕获" rel="tag">异常捕获</a>&nbsp;
    
        <a href="/tag/#windows" title="Tag: windows" rel="tag">windows</a>&nbsp;
    
        <a href="/tag/#linux" title="Tag: linux" rel="tag">linux</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <p>TBOX封装了一套跨平台的异常捕获实现，来模拟windows的seh异常处理功能，而且是线程安全的。</p>

<h3 id="linuxmac">在linux/mac下的实现</h3>

<ul>
  <li>使用signal 捕获异常信号</li>
  <li>使用sigsetjmp保存现场寄存器和信号掩码，出现异常后使用 siglongjmp 跳转到异常处理过程，并恢复状态</li>
  <li>使用线程局部存储维护 sigjmpbuf 寄存器现场状态堆栈，保证多线程安全，并且可以实现多层嵌套捕获处理。</li>
</ul>

<h3 id="windows">在windows下的实现</h3>

<p>这个就不用多说了，在vs下直接用 __try、__except 关键字就行了，如果在mingw下编译， 通过 setjmp实现也很方便。</p>

<h3 id="section">具体使用</h3>

<p>注： 由于使用setjmp 进行寄存器现场保护， 如果使用整型局部变量， 有可能会被编译器优化到寄存器中。
所以try内部的修改，可能会在异常捕获后，被会恢复掉。
最好加上volatile来禁止优化。</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code>    <span class="n">__tb_volatile__</span> <span class="n">tb_size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">__tb_try</span>
    <span class="p">{</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
        <span class="c1">// 捕获段错误
</span>        <span class="o">*</span><span class="p">((</span><span class="n">__tb_volatile__</span> <span class="n">tb_size_t</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c1">// 捕获除0错误
</span>        <span class="c1">// __tb_volatile__ tb_size_t a = 0; a /= a;
</span>    <span class="p">}</span>
    <span class="n">__tb_except</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// __tb_except(1): 处理异常
</span>        <span class="c1">// __tb_except(0): 路由异常到外层， 支持嵌套处理
</span>    <span class="p">}</span>
    <span class="n">__tb_end</span>
</code></pre>
</div>

<h3 id="section-1">注意事项</h3>

<p>有些平台异常捕获是被禁用的，所以如果确实想要使用这种异常捕获机制，首先得确保对应平台下的配置文件plat/xxx/config.h</p>

<p>定义了<code class="highlighter-rouge">TB_CONFIG_EXCEPTION_ENABLE</code>这个宏，然后重新编译才行。</p>

<p>虽然tbox对异常支持的挺完善了，但是个人还是不建议太过频繁的使用异常捕获。</p>


                </div>
                <div class="read-all">
                    <a href="/cn/2016/02/04/platform-exception/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/02/04/memory-pool/">内存池架构</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-02-04
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tbox" title="Category: tbox" rel="category">tbox</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#tbox" title="Tag: tbox" rel="tag">tbox</a>&nbsp;
    
        <a href="/tag/#c" title="Tag: c" rel="tag">c</a>&nbsp;
    
        <a href="/tag/#内存池" title="Tag: 内存池" rel="tag">内存池</a>&nbsp;
    
        <a href="/tag/#算法" title="Tag: 算法" rel="tag">算法</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <p>TBOX的内存管理模型，参考了linux kernel的内存管理机制，并在其基础上做了一些改进和优化。</p>

<h2 id="section">内存整体架构</h2>

<p><img src="/static/img/tbox/memorypool.png" alt="内存池架构" /></p>

<h2 id="largepool">large_pool</h2>
<p>整个内存分配的最底层，都是基于large_pool的大块内存分配池，类似于linux的基于page的分配管理，不过有所不同的是，large_pool并没有像linux那样使用buddy算法进行(2^N)*page进行分配，这样如果需要2.1m的内存，需要分配4m的内存块，这样力度太大，非常浪费。</p>

<p>因此large_pool内部采用N*page的基于page_size为最小粒度进行分配，因此每次分配顶多浪费不到一页的空间。</p>

<p>而且如果需要的内存不到整页，剩下的内存也会一并返回给上层，如果上层需要（比如small_pool），可以充分利用这多余的部分内存空间，使得内存利用率达到最优化。</p>

<p>而且根据tb_init实际传入的参数需求，large_pool有两种模式：</p>

<ol>
  <li>直接使用系统内存分配接口将进行大块内存的分配，并用双链维护，这种比较简单，就不多说了。</li>
  <li>在一大块连续内存上进行统一管理，实现内存分配。</li>
</ol>

<p>具体使用哪种方式，根据应用需求，一般的应用只需要使用方式1就行了，这个时候tb_init传tb_null就行了，如果是嵌入式应用，需要管理有限的一块内存空间，这个时候可以使用方式2， tb_init传入指定内存空间地址和大小。</p>

<p>这里就主要看下方式2的large_pool的内存结构（假设页大小是4KB）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>     --------------------------------------------------------------------------
    |                                     data                                 |
     --------------------------------------------------------------------------
                                         |
     --------------------------------------------------------------------------
    | head | 4KB | 16KB | 8KB | 128KB | ... | 32KB |       ...       |  4KB*N  |
     --------------------------------------------------------------------------
</code></pre>
</div>

<p>由于large_pool主要用于大块分配，而超小块的分配在上层small_pool中已经被分流掉了，所以这个应用中，large_pool不会太过频繁的分配，所以碎片量不会太大，为了进一步减少碎片的产生，在free时候都会对下一个邻近的空闲块进行合并。而malloc在分配当前空闲块空间不够的情况下，也会尝试对下一个邻近空闲块进行合并。</p>

<p>由于每个内存块都是邻近挨着的，也没用双链维护，没有内存块，都有个块头，合并过程仅仅只是改动内存块头部的size字段，这样的合并不会影响效率。</p>

<p>由于没像buddy算法那样，用双链维护空闲内存，虽然节省了链表维护的空间和时间，但是每次分配内存都要顺序遍历所有块，来查找空闲的内存，这样的效率实在太低了，为了解决这个问题，large_pool内部针对不同级别的块，进行了预测，每次free或者malloc的时候，如果都会把当前和邻近的空闲快，缓存到对应级别的预测池里面去，具体的分级如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>     --------------------------------------
    | &gt;0KB :      4KB       | &gt; 0*page     | 
    |-----------------------|--------------
    | &gt;4KB :      8KB       | &gt; 1*page     | 
    |-----------------------|--------------
    | &gt;8KB :    12-16KB     | &gt; 2*page     | 
    |-----------------------|--------------
    | &gt;16KB :   20-32KB     | &gt; 4*page     | 
    |-----------------------|--------------
    | &gt;32KB :   36-64KB     | &gt; 8*page     | 
    |-----------------------|--------------
    | &gt;64KB :   68-128KB    | &gt; 16*page    | 
    |-----------------------|--------------
    | &gt;128KB :  132-256KB   | &gt; 32*page    | 
    |-----------------------|--------------
    | &gt;256KB :  260-512KB   | &gt; 64*page    | 
    |-----------------------|--------------
    | &gt;512KB :  516-1024KB  | &gt; 128*page   | 
    |-----------------------|--------------
    | &gt;1024KB : 1028-...KB  | &gt; 256*page   | 
     --------------------------------------
</code></pre>
</div>

<p>由于通常不会分配太大块的内存，因此只要能够预测1m内存，就足够，而对于&gt;1m的内存，这里也单独加了一个预测，来应对偶尔的超大块分配，并且使得整体分配流程更加的统一。</p>

<p>如果当前级别的预测块不存在，则会到下一级别的预测块中查找，如果都找不到，才回去遍历整个内存池。</p>

<p>实际测试下，每个块的预测成功基本都在95%以上，也就说大部分情况下，分配效率都是维持在O(1)级别的。</p>

<h2 id="smallpool">small_pool</h2>

<p>小块内存分配池</p>

<p>在上层每次调用malloc进行内存分配的时候，回去判断需要多大的内存，如果这个内存超过或者等于一页，则会直接从large_pool进行分配，如果小于一页，则会优先通过small_pool进行分配，small_pool针对小块的内存进行了高速缓存，并优化了空间管理和分配效率。</p>

<p>由于程序大部分情况下，都在使用小块内存，因此small_pool对内存的分配做了很大的分流，使得large_pool承受的压力减小，碎片量减少很多，而small_pool内部由于都是由fixed_pool来对固定大小的内存进行管理，是不会存在外部碎片的。而小块内存的粒度本身就很小，所以内部碎片量也相当少。</p>

<p>small_pool中的fixed_pool，就像是linux kernel中的slub，在small_pool中总共有12级别的fixed_pool，每个级别分别管理一种固定大小的内存块，具体级别如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>     --------------------------------------
    |    fixed pool: 16B    |  1-16B       | 
    |--------------------------------------|
    |    fixed pool: 32B    |  17-32B      |  
    |--------------------------------------|
    |    fixed pool: 64B    |  33-64B      | 
    |--------------------------------------|
    |    fixed pool: 96B*   |  65-96B*     | 
    |--------------------------------------|
    |    fixed pool: 128B   |  97-128B     |  
    |--------------------------------------|
    |    fixed pool: 192B*  |  129-192B*   |  
    |--------------------------------------|
    |    fixed pool: 256B   |  193-256B    |  
    |--------------------------------------|
    |    fixed pool: 384B*  |  257-384B*   |  
    |--------------------------------------|
    |    fixed pool: 512B   |  385-512B    |  
    |--------------------------------------|
    |    fixed pool: 1024B  |  513-1024B   |  
    |--------------------------------------|
    |    fixed pool: 2048B  |  1025-2048B  |  
    |--------------------------------------|
    |    fixed pool: 3072B* |  2049-3072B* |  
     -------------------------------------- 
</code></pre>
</div>

<p>其中 96B, 192B，384B，3072B并不是按2的整数幂大小，这么做主要是为了更加有效的利用小块内存的空间减少内部碎片。</p>

<h2 id="fixedpool">fixed_pool</h2>

<p>顾名思义，fixed_pool就是用来管理固定大小的内存分配的，相当于linux中slub，而fixed_pool中又由多个slot组成，每个slot负责一块连续的内存空间，管理部分内存块的管理，类似linux中的slab， 每个slot由双链维护，并且参考linux的管理机制，分为三种slot管理方式：</p>

<ol>
  <li>当前正在分配的slot</li>
  <li>部分空闲slots链表</li>
  <li>完全full的slots链表</li>
</ol>

<p>具体结构如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    current:
         --------------
        |              |
     --------------    |
    |     slot     |&lt;--
    |--------------|
    ||||||||||||||||  
    |--------------| 
    |              | 
    |--------------| 
    |              | 
    |--------------| 
    ||||||||||||||||  
    |--------------| 
    |||||||||||||||| 
    |--------------| 
    |              | 
     --------------  

    partial:

     --------------       --------------               --------------
    |     slot     | &lt;=&gt; |     slot     | &lt;=&gt; ... &lt;=&gt; |     slot     |
    |--------------|     |--------------|             |--------------|
    ||||||||||||||||     |              |             |              |
    |--------------|     |--------------|             |--------------|
    |              |     ||||||||||||||||             |              |
    |--------------|     |--------------|             |--------------|
    |              |     ||||||||||||||||             ||||||||||||||||
    |--------------|     |--------------|             |--------------|
    ||||||||||||||||     ||||||||||||||||             |              |
    |--------------|     |--------------|             |--------------|
    ||||||||||||||||     |              |             |              |
    |--------------|     |--------------|             |--------------|
    |              |     |              |             ||||||||||||||||
    --------------       --------------               --------------

    full:

     --------------       --------------               --------------
    |     slot     | &lt;=&gt; |     slot     | &lt;=&gt; ... &lt;=&gt; |     slot     |
    |--------------|     |--------------|             |--------------|
    ||||||||||||||||     ||||||||||||||||             ||||||||||||||||
    |--------------|     |--------------|             |--------------|
    ||||||||||||||||     ||||||||||||||||             ||||||||||||||||
    |--------------|     |--------------|             |--------------|
    ||||||||||||||||     ||||||||||||||||             ||||||||||||||||
    |--------------|     |--------------|             |--------------|
    ||||||||||||||||     ||||||||||||||||             ||||||||||||||||
    |--------------|     |--------------|             |--------------|
    ||||||||||||||||     ||||||||||||||||             ||||||||||||||||
    |--------------|     |--------------|             |--------------|
    ||||||||||||||||     ||||||||||||||||             ||||||||||||||||
     --------------       --------------               --------------
</code></pre>
</div>

<p><strong>具体的分配算法</strong></p>

<ol>
  <li>如果当前slot中还有空闲的块，优先从当前slot进行分配</li>
  <li>如果当前slot中没有空闲块，则把这个slot放到full链表中去</li>
  <li>从部分空闲slot链表中，挑一个空闲的slot进行分配，并把它设为当前分配状态。</li>
</ol>

<p><strong>具体的释放算法</strong></p>

<ol>
  <li>释放后如果这个slot完全空闲了，并且不是正在分配的slot，则把整个slot释放掉，这样既可以保证有一个可以分配的slot之外，还极大的降低了内存使用，也避免某些情况下频繁的释放分配slot。</li>
  <li>如果释放的slot属于full链表并且变为了部分空闲，则把这个slot移到部分空闲slot链表中去。</li>
</ol>

<p><strong>额外要提一下的是</strong>：</p>

<p>large_pool每次分配一块空间给一个slot的时候，残留下来的部分剩余空间(&lt;1*page)， 也能直接返回给slot，让slot充分利用这部分数据，这样可以可以切分出更多地内存块。</p>

<p>例如：</p>

<p>fixed_pool每次增长一个包含256个32B内存块的slot（需要8192B大小+16B内部数据维护大小），其实在用large_pool分配的时候，需要8208B的大小，由于需要按页对齐（4KB），实际分配确占用了<code class="highlighter-rouge">8192+4096: 12288B</code>的大小的空间。</p>

<p>但是large_pool支持把所有空间数据一并返回给上层，这样slot其实获取到了一个12288B大小的内存，并且也知道其实际大小为：12288B，因此实际切分了<code class="highlighter-rouge">(12288-(32B的slot内部维护数据))/32</code>也就是383个内存块。</p>

<p>多维护了127个内存块，充分把large_pool的内部碎片也利用上了，进一步增加了内存利用率。</p>

<h2 id="fixedpoolslot">fixed_pool中的slot</h2>

<p>虽然类比与linux中的slab，但是其数据结构确跟slab不太一样，它并没有像slab那样，对每个空闲小块都用链表维护，而是直接用位段来维护是否空闲的信息，这样更加节省内存，而且通过优化算法，其分配效率和slab几乎一样。</p>

<p>在fixed_pool的slot的头部，专门有一小块独立的数据，用于维护每个小块的空闲信息，每个块只暂用一比特位的信息，来判断这个块是否空闲，由于没有内存块都是固定大小的，所以比特位的位置定位，完全可以通过索引计算得到。</p>

<p>而且每次释放和分配，都会去缓存一个双字大小的位信息端，来预测下一次的分配，由于是双字大小，总共有32个比特位，所以每次缓存，最多可以预测邻近32个内存块。因此大部分情况下，预测成功率一直都是&gt;98%的，分配效率都维持在O(1)，比起large_pool的预测率还高很多，所以small_pool对large_pool的分流，还在一定程度上，进一步提高了内存分配效率。</p>

<p>而就算很倒霉，没预测成功，slot的顺序遍历来查找空闲快的算法，也相当高效，完全是高度优化的，下面就详细描述下。</p>

<h3 id="slot">slot的顺序遍历分配算法优化</h3>

<p>我们这里主要用到了gcc的几个内置函数：</p>

<ol>
  <li>__builtin_clz：计算32位整数前导0的个数</li>
  <li>__builtin_ctz：计算32位整数后置0的个数</li>
  <li>__builtin_clzll：计算64位整数前导0的个数</li>
  <li>__builtin_ctzll：计算64位整数后置0的个数</li>
</ol>

<p>其实这四个类似，我们这里就拿第一说明好了，为什么要使用__builtin_clz呢？其实就是为了在一个32位端里面，快速查找某个空闲位的索引，这样就能快速定位某个空闲块的位置了。</p>

<p>比如有一个32位的位段信息整数：x，计算对应空闲位0的索引，主需要：<code class="highlighter-rouge">__builtin_clz(~x)</code></p>

<p>简单吧，由于__builtin_clz这些内置函数，gcc用汇编针对不同平台高度优化过的，计算起来相当的快，那如果不是gcc的编译器怎么办呢？</p>

<p>没关系，我们可以自己用c实现个优化版本的，当然完全可以汇编继续优化，这里就先给个c的实现：</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code>    <span class="k">static</span> <span class="n">__tb_inline__</span> <span class="n">tb_size_t</span> <span class="nf">tb_bits_cl0_u32_be_inline</span><span class="p">(</span><span class="n">tb_uint32_t</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// check
</span>        <span class="n">tb_check_return_val</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>

        <span class="c1">// done
</span>        <span class="n">tb_size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0xffff0000</span><span class="p">)</span> <span class="p">{</span> <span class="n">n</span> <span class="o">-=</span> <span class="mi">16</span><span class="p">;</span>  <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="mi">16</span><span class="p">;</span>   <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span>     <span class="p">{</span> <span class="n">n</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>   <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>    <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">)</span>       <span class="p">{</span> <span class="n">n</span> <span class="o">-=</span> <span class="mi">4</span><span class="p">;</span>   <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>    <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0xc</span><span class="p">)</span>        <span class="p">{</span> <span class="n">n</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>   <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span>    <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">)</span>        <span class="p">{</span> <span class="n">n</span><span class="o">--</span><span class="p">;</span>                  <span class="p">}</span>
        <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>说白了，就是每次对半开，来减少判断次数，比起每次一位一位的枚举遍历，这种已经是相当高效了，更何况还有__builtin_clz呢。</p>

<p><strong>接下来就看下具体的遍历过程：</strong></p>

<ol>
  <li>按4/8字节对齐位段的起始地址</li>
  <li>每次按4/8字节遍历位段数据，遍历过程利用cpu cache的大小，针对性的做循环展开，来优化性能。</li>
  <li>通过判断 !(x + 1) 来快速过滤 0xffffffff 这些已经满了的位段，进一步提高遍历效率。</li>
  <li>如果某个位段不是0xffffffff，则通过__builtin_clz(~x)计算实际的空闲块索引，并进行实际的分配。</li>
  <li>最后如果这个的32位的位段没有被分配满，可以把它进行缓存，来为下次分配做预测。</li>
</ol>

<h2 id="stringpool">string_pool</h2>

<p>讲到这，TBOX的内存池管理模型，基本算是大概讲完了，这里就简单提下string_pool，即：字符串池</p>

<p>string_pool主要针对上层应用而言的，针对某些频繁使用小型字符串，并且重复率很高的模块，就可以通过string_pool进行优化，进一步减少内存使用，string_pool内部通过引用计数+哈希表维护，针对相同的字符串只保存一份。</p>

<p>例如可以用于cookies中字符串维护、http中header部分的字符串维护等等。。</p>


                </div>
                <div class="read-all">
                    <a href="/cn/2016/02/04/memory-pool/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <a href="/index.html" class="previous"><i class="fa fa-angle-double-left"></i></a>
            <a href="/cn/page5" class="previous"><i class="fa fa-angle-left"></i></a>
          
          <span class="page_number ">6/8</span>
          
            <a href="/cn/page7" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/page8" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    最近文章
                </div>
                <ul class="content-ul" recent="">
                    
                    
                    
                    
                        <li><a href="/cn/2016/07/17/update-v2.0.3/">xmake v2.0.3 更新!</a></li>
                    
                    
                    
                    
                    
                        <li><a href="/cn/2016/07/17/demo-build-a-simple-project/">演示：构建一个简单的程序</a></li>
                    
                    
                    
                        <li><a href="/cn/2016/07/16/run-debug/">利用xmake运行和调试程序</a></li>
                    
                    
                    
                    
                    
                        <li><a href="/cn/2016/07/16/how-to-build-a-simple-project/">如何快速构建一个简单的程序</a></li>
                    
                    
                    
                    
                    
                        <li><a href="/cn/2016/07/14/plugin-print-colors/">插件开发之色彩高亮显示</a></li>
                    
                    
                    
                        <li><a href="/cn/2016/07/12/includes-check/">头文件自动依赖检测和构建</a></li>
                    
                    
                </ul>
            </div>

            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    分类
                </div>
                <ul class="content-ul" cate="">
                    
                    <li>
                        <a href="/category/#tboox" class="categories-list-item" cate="tboox">
                            <span class="name">
                                tboox
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#tbox" class="categories-list-item" cate="tbox">
                            <span class="name">
                                tbox
                            </span>
                            <span class="badge">15</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#xmake" class="categories-list-item" cate="xmake">
                            <span class="name">
                                xmake
                            </span>
                            <span class="badge">36</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    标记
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                      
                      
                      
                      
                      
                      <a href="/tag/#tboox" style="font-size: 9.5pt; color: #999;">tboox</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#站点" style="font-size: 9.5pt; color: #999;">站点</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#website" style="font-size: 9.5pt; color: #999;">website</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#tbox" style="font-size: 12.5pt; color: #555;">tbox</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#c" style="font-size: 12.5pt; color: #555;">c</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#bloom" style="font-size: 9pt; color: #999;">bloom</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#filter" style="font-size: 9pt; color: #999;">filter</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#算法" style="font-size: 9.5pt; color: #888;">算法</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#大数据" style="font-size: 9pt; color: #999;">大数据</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#过滤" style="font-size: 9pt; color: #999;">过滤</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#xmake" style="font-size: 18pt; color: #000;">xmake</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#lua" style="font-size: 17.5pt; color: #111;">lua</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#premake" style="font-size: 9pt; color: #999;">premake</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#排序" style="font-size: 9pt; color: #999;">排序</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#查找" style="font-size: 9pt; color: #999;">查找</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#哈希" style="font-size: 9pt; color: #999;">哈希</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#容器" style="font-size: 9pt; color: #999;">容器</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#迭代器" style="font-size: 9pt; color: #999;">迭代器</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#内存检测" style="font-size: 9pt; color: #999;">内存检测</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#内存池" style="font-size: 9pt; color: #999;">内存池</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#跨平台" style="font-size: 9.5pt; color: #999;">跨平台</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#异常捕获" style="font-size: 9pt; color: #999;">异常捕获</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#windows" style="font-size: 10pt; color: #888;">windows</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#linux" style="font-size: 9pt; color: #999;">linux</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#线程池" style="font-size: 9pt; color: #999;">线程池</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#裁剪" style="font-size: 9pt; color: #999;">裁剪</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#编译" style="font-size: 10pt; color: #888;">编译</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#配置" style="font-size: 9pt; color: #999;">配置</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#stream" style="font-size: 9.5pt; color: #999;">stream</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#流" style="font-size: 9.5pt; color: #999;">流</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#解压缩" style="font-size: 9pt; color: #999;">解压缩</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#静态库" style="font-size: 9pt; color: #999;">静态库</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#模式匹配" style="font-size: 9pt; color: #999;">模式匹配</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#版本更新" style="font-size: 10pt; color: #888;">版本更新</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#version" style="font-size: 9.5pt; color: #999;">version</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#update" style="font-size: 10pt; color: #888;">update</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#进程控制" style="font-size: 9pt; color: #999;">进程控制</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#process" style="font-size: 9pt; color: #999;">process</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#插件" style="font-size: 11.5pt; color: #777;">插件</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#import" style="font-size: 9pt; color: #999;">import</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#类库" style="font-size: 9.5pt; color: #999;">类库</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#自定义脚本" style="font-size: 9.5pt; color: #888;">自定义脚本</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#安装" style="font-size: 9pt; color: #999;">安装</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#打包" style="font-size: 9.5pt; color: #999;">打包</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#android" style="font-size: 9pt; color: #999;">android</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#apk" style="font-size: 9pt; color: #999;">apk</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#jni" style="font-size: 9pt; color: #999;">jni</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#task" style="font-size: 9.5pt; color: #999;">task</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#菜单选项" style="font-size: 9pt; color: #999;">菜单选项</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#hello" style="font-size: 10pt; color: #888;">hello</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#makefile" style="font-size: 9pt; color: #999;">makefile</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#doxygen" style="font-size: 9.5pt; color: #999;">doxygen</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#宏脚本" style="font-size: 9.5pt; color: #888;">宏脚本</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#plugin" style="font-size: 9.5pt; color: #888;">plugin</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#macro" style="font-size: 9pt; color: #999;">macro</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#包管理" style="font-size: 9pt; color: #999;">包管理</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#代码移植编译" style="font-size: 9pt; color: #999;">代码移植编译</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#example" style="font-size: 9.5pt; color: #999;">example</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#xmake.lua" style="font-size: 9pt; color: #999;">xmake.lua</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#compile" style="font-size: 9pt; color: #999;">compile</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#configure" style="font-size: 9pt; color: #999;">configure</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#create" style="font-size: 9pt; color: #999;">create</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#project" style="font-size: 9.5pt; color: #888;">project</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#template" style="font-size: 9pt; color: #999;">template</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#package" style="font-size: 9pt; color: #999;">package</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#run" style="font-size: 9pt; color: #999;">run</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#xmake.io" style="font-size: 10.5pt; color: #888;">xmake.io</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#scripts" style="font-size: 9pt; color: #999;">scripts</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#头文件依赖" style="font-size: 9pt; color: #999;">头文件依赖</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#增量编译" style="font-size: 9pt; color: #999;">增量编译</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#终端色彩高亮" style="font-size: 9pt; color: #999;">终端色彩高亮</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#check" style="font-size: 9pt; color: #999;">check</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#batch" style="font-size: 9pt; color: #999;">batch</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#function" style="font-size: 9pt; color: #999;">function</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#交叉编译" style="font-size: 9.5pt; color: #999;">交叉编译</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#build" style="font-size: 9.5pt; color: #999;">build</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#调试" style="font-size: 9pt; color: #999;">调试</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#运行" style="font-size: 9pt; color: #999;">运行</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#演示" style="font-size: 9pt; color: #999;">演示</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#demo" style="font-size: 9pt; color: #999;">demo</a>
                    
                </div>
            </div>

            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    链接
                </div>
                <ul class="content-ul">
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                </ul>
            </div> 

            
        </div>
    </div>
</div>
<!-- <script src="/js/scroll.min.js " charset="utf-8"></script> -->
<!-- <script src="/js/pageContent.js " charset="utf-8"></script> -->


    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016 tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
