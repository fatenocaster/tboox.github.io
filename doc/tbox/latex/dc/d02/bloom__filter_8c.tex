\hypertarget{bloom__filter_8c}{\section{src/tbox/container/bloom\-\_\-filter.c File Reference}
\label{bloom__filter_8c}\index{src/tbox/container/bloom\-\_\-filter.\-c@{src/tbox/container/bloom\-\_\-filter.\-c}}
}
{\ttfamily \#include \char`\"{}bloom\-\_\-filter.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../libc/libc.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../libm/libm.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../math/math.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../utils/utils.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../memory/memory.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../stream/stream.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../platform/platform.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../algorithm/algorithm.\-h\char`\"{}}\\*
Include dependency graph for bloom\-\_\-filter.\-c\-:
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{bloom__filter_8c_a2aa61763aba311653f75dfdea928da4e}{\#define {\bfseries T\-B\-\_\-\-T\-R\-A\-C\-E\-\_\-\-M\-O\-D\-U\-L\-E\-\_\-\-N\-A\-M\-E}~\char`\"{}bloom\-\_\-filter\char`\"{}}\label{bloom__filter_8c_a2aa61763aba311653f75dfdea928da4e}

\item 
\hypertarget{bloom__filter_8c_ab5dd5585b246c36fdb275f9781170000}{\#define {\bfseries T\-B\-\_\-\-T\-R\-A\-C\-E\-\_\-\-M\-O\-D\-U\-L\-E\-\_\-\-D\-E\-B\-U\-G}~(1)}\label{bloom__filter_8c_ab5dd5585b246c36fdb275f9781170000}

\item 
\hypertarget{bloom__filter_8c_a1de0e4345b918eff2f87bcf48140cb59}{\#define {\bfseries T\-B\-\_\-\-B\-L\-O\-O\-M\-\_\-\-F\-I\-L\-T\-E\-R\-\_\-\-D\-A\-T\-A\-\_\-\-M\-A\-X\-N}~(1 $<$$<$ 30)}\label{bloom__filter_8c_a1de0e4345b918eff2f87bcf48140cb59}

\item 
\hypertarget{bloom__filter_8c_a944c770b27f965afe573d51c8f30cd66}{\#define {\bfseries T\-B\-\_\-\-B\-L\-O\-O\-M\-\_\-\-F\-I\-L\-T\-E\-R\-\_\-\-I\-T\-E\-M\-\_\-\-M\-A\-X\-N\-\_\-\-D\-E\-F\-A\-U\-L\-T}~T\-B\-\_\-\-B\-L\-O\-O\-M\-\_\-\-F\-I\-L\-T\-E\-R\-\_\-\-I\-T\-E\-M\-\_\-\-M\-A\-X\-N\-\_\-\-S\-M\-A\-L\-L}\label{bloom__filter_8c_a944c770b27f965afe573d51c8f30cd66}

\item 
\hypertarget{bloom__filter_8c_af88c47f91a97e86d5d7683926df9aeb4}{\#define {\bfseries tb\-\_\-bloom\-\_\-filter\-\_\-set1}(data, i)~do \{(data)\mbox{[}(i) $>$$>$ 3\mbox{]} $\vert$= (0x1 $<$$<$ ((i) \& 7));\} while (0)}\label{bloom__filter_8c_af88c47f91a97e86d5d7683926df9aeb4}

\item 
\hypertarget{bloom__filter_8c_a6d94aa002436cf0a33a1732582ff0f2a}{\#define {\bfseries tb\-\_\-bloom\-\_\-filter\-\_\-set0}(data, i)~do \{(data)\mbox{[}(i) $>$$>$ 3\mbox{]} \&= $\sim$(0x1 $<$$<$ ((i) \& 7));\} while (0)}\label{bloom__filter_8c_a6d94aa002436cf0a33a1732582ff0f2a}

\item 
\hypertarget{bloom__filter_8c_a8b7cae37b4feb1e91023c533c8e84080}{\#define {\bfseries tb\-\_\-bloom\-\_\-filter\-\_\-bset}(data, i)~((data)\mbox{[}(i) $>$$>$ 3\mbox{]} \& (0x1 $<$$<$ ((i) \& 7)))}\label{bloom__filter_8c_a8b7cae37b4feb1e91023c533c8e84080}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{structtb__bloom__filter__ref__t}{tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t} \hyperlink{bloom__filter_8c_a1e2fb870d8a00a4d99fb483d5e851df8}{tb\-\_\-bloom\-\_\-filter\-\_\-init} (tb\-\_\-size\-\_\-t probability, tb\-\_\-size\-\_\-t hash\-\_\-count, tb\-\_\-size\-\_\-t item\-\_\-maxn, \hyperlink{structtb__item__func__t}{tb\-\_\-item\-\_\-func\-\_\-t} func)
\item 
tb\-\_\-void\-\_\-t \hyperlink{bloom__filter_8c_aec98ca11825f2f144823f6af192dc674}{tb\-\_\-bloom\-\_\-filter\-\_\-exit} (\hyperlink{structtb__bloom__filter__ref__t}{tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t} handle)
\item 
tb\-\_\-void\-\_\-t \hyperlink{bloom__filter_8c_a9bf73be528f1705c1de5470a36d3b7e1}{tb\-\_\-bloom\-\_\-filter\-\_\-clear} (\hyperlink{structtb__bloom__filter__ref__t}{tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t} handle)
\item 
tb\-\_\-bool\-\_\-t \hyperlink{bloom__filter_8c_ad2ea6acd70fb572aae44ff6364ed758d}{tb\-\_\-bloom\-\_\-filter\-\_\-set} (\hyperlink{structtb__bloom__filter__ref__t}{tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t} handle, tb\-\_\-cpointer\-\_\-t data)
\item 
tb\-\_\-bool\-\_\-t \hyperlink{bloom__filter_8c_a6217cf482aeb20a98027495e6c3a8b14}{tb\-\_\-bloom\-\_\-filter\-\_\-get} (\hyperlink{structtb__bloom__filter__ref__t}{tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t} handle, tb\-\_\-cpointer\-\_\-t data)
\item 
tb\-\_\-bool\-\_\-t \hyperlink{bloom__filter_8c_a94d21eb90f0106d3a84d9d2d4afd704a}{tb\-\_\-bloom\-\_\-filter\-\_\-load} (\hyperlink{structtb__bloom__filter__ref__t}{tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t} bloom\-\_\-filter, \hyperlink{structtb__stream__ref__t}{tb\-\_\-stream\-\_\-ref\-\_\-t} stream)
\item 
tb\-\_\-bool\-\_\-t \hyperlink{bloom__filter_8c_a610b3632085ba1a1e462f8613539a0ba}{tb\-\_\-bloom\-\_\-filter\-\_\-save} (\hyperlink{structtb__bloom__filter__ref__t}{tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t} bloom\-\_\-filter, \hyperlink{structtb__stream__ref__t}{tb\-\_\-stream\-\_\-ref\-\_\-t} stream)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
The Treasure Box Library

T\-Box is free software; you can redistribute it and/or modify it under the terms of the G\-N\-U Lesser General Public License as published by the Free Software Foundation; either version 2.\-1 of the License, or (at your option) any later version.

T\-Box is distributed in the hope that it will be useful, but W\-I\-T\-H\-O\-U\-T A\-N\-Y W\-A\-R\-R\-A\-N\-T\-Y; without even the implied warranty of M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y or F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E. See the G\-N\-U Lesser General Public License for more details.

You should have received a copy of the G\-N\-U Lesser General Public License along with T\-Box; If not, see \href{http://www.gnu.org/licenses/}{\tt http\-://www.\-gnu.\-org/licenses/}

Copyright (C) 2009 -\/ 2015, ruki All rights reserved.

\begin{DoxyAuthor}{Author}
ruki 
\end{DoxyAuthor}


Definition in file \hyperlink{bloom__filter_8c_source}{bloom\-\_\-filter.\-c}.



\subsection{Function Documentation}
\hypertarget{bloom__filter_8c_a9bf73be528f1705c1de5470a36d3b7e1}{\index{bloom\-\_\-filter.\-c@{bloom\-\_\-filter.\-c}!tb\-\_\-bloom\-\_\-filter\-\_\-clear@{tb\-\_\-bloom\-\_\-filter\-\_\-clear}}
\index{tb\-\_\-bloom\-\_\-filter\-\_\-clear@{tb\-\_\-bloom\-\_\-filter\-\_\-clear}!bloom_filter.c@{bloom\-\_\-filter.\-c}}
\subsubsection[{tb\-\_\-bloom\-\_\-filter\-\_\-clear}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-bloom\-\_\-filter\-\_\-clear (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t}}]{bloom\-\_\-filter}
\end{DoxyParamCaption}
)}}\label{bloom__filter_8c_a9bf73be528f1705c1de5470a36d3b7e1}
clear bloom filter


\begin{DoxyParams}{Parameters}
{\em bloom\-\_\-filter} & the bloom filter \\
\hline
\end{DoxyParams}


Definition at line 232 of file bloom\-\_\-filter.\-c.



Referenced by tb\-\_\-bloom\-\_\-filter\-\_\-load().

\hypertarget{bloom__filter_8c_aec98ca11825f2f144823f6af192dc674}{\index{bloom\-\_\-filter.\-c@{bloom\-\_\-filter.\-c}!tb\-\_\-bloom\-\_\-filter\-\_\-exit@{tb\-\_\-bloom\-\_\-filter\-\_\-exit}}
\index{tb\-\_\-bloom\-\_\-filter\-\_\-exit@{tb\-\_\-bloom\-\_\-filter\-\_\-exit}!bloom_filter.c@{bloom\-\_\-filter.\-c}}
\subsubsection[{tb\-\_\-bloom\-\_\-filter\-\_\-exit}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-bloom\-\_\-filter\-\_\-exit (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t}}]{bloom\-\_\-filter}
\end{DoxyParamCaption}
)}}\label{bloom__filter_8c_aec98ca11825f2f144823f6af192dc674}
exit bloom filter


\begin{DoxyParams}{Parameters}
{\em bloom\-\_\-filter} & the bloom filter \\
\hline
\end{DoxyParams}


Definition at line 219 of file bloom\-\_\-filter.\-c.



Referenced by tb\-\_\-bloom\-\_\-filter\-\_\-init().

\hypertarget{bloom__filter_8c_a6217cf482aeb20a98027495e6c3a8b14}{\index{bloom\-\_\-filter.\-c@{bloom\-\_\-filter.\-c}!tb\-\_\-bloom\-\_\-filter\-\_\-get@{tb\-\_\-bloom\-\_\-filter\-\_\-get}}
\index{tb\-\_\-bloom\-\_\-filter\-\_\-get@{tb\-\_\-bloom\-\_\-filter\-\_\-get}!bloom_filter.c@{bloom\-\_\-filter.\-c}}
\subsubsection[{tb\-\_\-bloom\-\_\-filter\-\_\-get}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-bool\-\_\-t tb\-\_\-bloom\-\_\-filter\-\_\-get (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t}}]{bloom\-\_\-filter, }
\item[{tb\-\_\-cpointer\-\_\-t}]{data}
\end{DoxyParamCaption}
)}}\label{bloom__filter_8c_a6217cf482aeb20a98027495e6c3a8b14}
get data to the bloom filter


\begin{DoxyCode}
\textcolor{keywordflow}{if} (\hyperlink{bloom__filter_8c_a6217cf482aeb20a98027495e6c3a8b14}{tb\_bloom\_filter\_get}(filter, data))
\{
    tb\_trace\_i(\textcolor{stringliteral}{"this data have been existed, get ok!"});

    \textcolor{comment}{// note: maybe false positives}
\}
\textcolor{keywordflow}{else}
\{
    tb\_trace\_i(\textcolor{stringliteral}{"this data not exists, get failed!"});
\}
\end{DoxyCode}



\begin{DoxyParams}{Parameters}
{\em bloom\-\_\-filter} & the bloom filter \\
\hline
{\em data} & the item data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
return tb\-\_\-true if the data exists, otherwise return tb\-\_\-false 
\end{DoxyReturn}


Definition at line 271 of file bloom\-\_\-filter.\-c.

\hypertarget{bloom__filter_8c_a1e2fb870d8a00a4d99fb483d5e851df8}{\index{bloom\-\_\-filter.\-c@{bloom\-\_\-filter.\-c}!tb\-\_\-bloom\-\_\-filter\-\_\-init@{tb\-\_\-bloom\-\_\-filter\-\_\-init}}
\index{tb\-\_\-bloom\-\_\-filter\-\_\-init@{tb\-\_\-bloom\-\_\-filter\-\_\-init}!bloom_filter.c@{bloom\-\_\-filter.\-c}}
\subsubsection[{tb\-\_\-bloom\-\_\-filter\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t} tb\-\_\-bloom\-\_\-filter\-\_\-init (
\begin{DoxyParamCaption}
\item[{tb\-\_\-size\-\_\-t}]{probability, }
\item[{tb\-\_\-size\-\_\-t}]{hash\-\_\-count, }
\item[{tb\-\_\-size\-\_\-t}]{item\-\_\-maxn, }
\item[{{\bf tb\-\_\-item\-\_\-func\-\_\-t}}]{func}
\end{DoxyParamCaption}
)}}\label{bloom__filter_8c_a1e2fb870d8a00a4d99fb483d5e851df8}
init bloom filter

\begin{DoxyNote}{Note}
not supports iterator
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em probability} & the probability of false positives \\
\hline
{\em hash\-\_\-count} & the hash count\-: $<$ 16 \\
\hline
{\em item\-\_\-maxn} & the item maxn \\
\hline
{\em func} & the item func only for hash\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the bloom\-\_\-filter 
\end{DoxyReturn}


Definition at line 100 of file bloom\-\_\-filter.\-c.



References tb\-\_\-item\-\_\-func\-\_\-t\-::hash, tb\-\_\-bloom\-\_\-filter\-\_\-exit(), and tb\-\_\-printf().

\hypertarget{bloom__filter_8c_a94d21eb90f0106d3a84d9d2d4afd704a}{\index{bloom\-\_\-filter.\-c@{bloom\-\_\-filter.\-c}!tb\-\_\-bloom\-\_\-filter\-\_\-load@{tb\-\_\-bloom\-\_\-filter\-\_\-load}}
\index{tb\-\_\-bloom\-\_\-filter\-\_\-load@{tb\-\_\-bloom\-\_\-filter\-\_\-load}!bloom_filter.c@{bloom\-\_\-filter.\-c}}
\subsubsection[{tb\-\_\-bloom\-\_\-filter\-\_\-load}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-bool\-\_\-t tb\-\_\-bloom\-\_\-filter\-\_\-load (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t}}]{bloom\-\_\-filter, }
\item[{{\bf tb\-\_\-stream\-\_\-ref\-\_\-t}}]{stream}
\end{DoxyParamCaption}
)}}\label{bloom__filter_8c_a94d21eb90f0106d3a84d9d2d4afd704a}
load bloom\-\_\-filter from the stream


\begin{DoxyParams}{Parameters}
{\em bloom\-\_\-filter} & the bloom filter \\
\hline
{\em stream} & the stream\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
tb\-\_\-true or tb\-\_\-false 
\end{DoxyReturn}


Definition at line 293 of file bloom\-\_\-filter.\-c.



References tb\-\_\-bloom\-\_\-filter\-\_\-clear(), tb\-\_\-crc\-\_\-encode(), tb\-\_\-crc\-\_\-encode\-\_\-cstr(), tb\-\_\-stream\-\_\-bread(), tb\-\_\-stream\-\_\-bread\-\_\-u32\-\_\-be(), tb\-\_\-stream\-\_\-offset(), and tb\-\_\-stream\-\_\-seek().

\hypertarget{bloom__filter_8c_a610b3632085ba1a1e462f8613539a0ba}{\index{bloom\-\_\-filter.\-c@{bloom\-\_\-filter.\-c}!tb\-\_\-bloom\-\_\-filter\-\_\-save@{tb\-\_\-bloom\-\_\-filter\-\_\-save}}
\index{tb\-\_\-bloom\-\_\-filter\-\_\-save@{tb\-\_\-bloom\-\_\-filter\-\_\-save}!bloom_filter.c@{bloom\-\_\-filter.\-c}}
\subsubsection[{tb\-\_\-bloom\-\_\-filter\-\_\-save}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-bool\-\_\-t tb\-\_\-bloom\-\_\-filter\-\_\-save (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t}}]{bloom\-\_\-filter, }
\item[{{\bf tb\-\_\-stream\-\_\-ref\-\_\-t}}]{stream}
\end{DoxyParamCaption}
)}}\label{bloom__filter_8c_a610b3632085ba1a1e462f8613539a0ba}
save bloom\-\_\-filter to the stream


\begin{DoxyParams}{Parameters}
{\em bloom\-\_\-filter} & the bloom filter \\
\hline
{\em stream} & the stream\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
tb\-\_\-true or tb\-\_\-false 
\end{DoxyReturn}


Definition at line 364 of file bloom\-\_\-filter.\-c.



References tb\-\_\-crc\-\_\-encode(), tb\-\_\-crc\-\_\-encode\-\_\-cstr(), tb\-\_\-stream\-\_\-bwrit(), tb\-\_\-stream\-\_\-bwrit\-\_\-u32\-\_\-be(), tb\-\_\-stream\-\_\-offset(), and tb\-\_\-stream\-\_\-seek().

\hypertarget{bloom__filter_8c_ad2ea6acd70fb572aae44ff6364ed758d}{\index{bloom\-\_\-filter.\-c@{bloom\-\_\-filter.\-c}!tb\-\_\-bloom\-\_\-filter\-\_\-set@{tb\-\_\-bloom\-\_\-filter\-\_\-set}}
\index{tb\-\_\-bloom\-\_\-filter\-\_\-set@{tb\-\_\-bloom\-\_\-filter\-\_\-set}!bloom_filter.c@{bloom\-\_\-filter.\-c}}
\subsubsection[{tb\-\_\-bloom\-\_\-filter\-\_\-set}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-bool\-\_\-t tb\-\_\-bloom\-\_\-filter\-\_\-set (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-bloom\-\_\-filter\-\_\-ref\-\_\-t}}]{bloom\-\_\-filter, }
\item[{tb\-\_\-cpointer\-\_\-t}]{data}
\end{DoxyParamCaption}
)}}\label{bloom__filter_8c_ad2ea6acd70fb572aae44ff6364ed758d}
set data to the bloom filter


\begin{DoxyCode}
\textcolor{keywordflow}{if} (\hyperlink{bloom__filter_8c_ad2ea6acd70fb572aae44ff6364ed758d}{tb\_bloom\_filter\_set}(filter, data))
\{
    tb\_trace\_i(\textcolor{stringliteral}{"this data not exists, set ok!"});
\}
\textcolor{keywordflow}{else}
\{
    tb\_trace\_i(\textcolor{stringliteral}{"this data have been existed, set failed!"});

    \textcolor{comment}{// note: maybe false positives}
\}
\end{DoxyCode}



\begin{DoxyParams}{Parameters}
{\em bloom\-\_\-filter} & the bloom filter \\
\hline
{\em data} & the item data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
return tb\-\_\-false if the data have been existed, otherwise set it and return tb\-\_\-true 
\end{DoxyReturn}


Definition at line 241 of file bloom\-\_\-filter.\-c.

