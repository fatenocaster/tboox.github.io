\hypertarget{fpool_8c}{\section{src/memory/fpool.c File Reference}
\label{fpool_8c}\index{src/memory/fpool.\-c@{src/memory/fpool.\-c}}
}
{\ttfamily \#include \char`\"{}fpool.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../libc/libc.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../math/math.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../utils/utils.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../platform/platform.\-h\char`\"{}}\\*
Include dependency graph for fpool.\-c\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d4b/fpool_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{fpool_8c_aaded52f3235549d18a583a753ea8949d}{\#define {\bfseries T\-B\-\_\-\-F\-P\-O\-O\-L\-\_\-\-M\-A\-G\-I\-C}~(0xdeaf)}\label{fpool_8c_aaded52f3235549d18a583a753ea8949d}

\item 
\hypertarget{fpool_8c_ae9f853dbffd6e120de28ce34c502c3a7}{\#define {\bfseries T\-B\-\_\-\-F\-P\-O\-O\-L\-\_\-\-A\-L\-I\-G\-N\-\_\-\-M\-A\-X\-N}~(128)}\label{fpool_8c_ae9f853dbffd6e120de28ce34c502c3a7}

\item 
\hypertarget{fpool_8c_a80a444278acdf401976e37d97f1c3b8a}{\#define {\bfseries tb\-\_\-fpool\-\_\-used\-\_\-set1}(used, i)~do \{(used)\mbox{[}(i) $>$$>$ 3\mbox{]} $\vert$= (0x1 $<$$<$ ((i) \& 7));\} while (0)}\label{fpool_8c_a80a444278acdf401976e37d97f1c3b8a}

\item 
\hypertarget{fpool_8c_a63813247bc8f267f78e607802bba32df}{\#define {\bfseries tb\-\_\-fpool\-\_\-used\-\_\-set0}(used, i)~do \{(used)\mbox{[}(i) $>$$>$ 3\mbox{]} \&= $\sim$(0x1 $<$$<$ ((i) \& 7));\} while (0)}\label{fpool_8c_a63813247bc8f267f78e607802bba32df}

\item 
\hypertarget{fpool_8c_a282a07460b6404ef56a9f28ccd922ed2}{\#define {\bfseries tb\-\_\-fpool\-\_\-used\-\_\-bset}(used, i)~((used)\mbox{[}(i) $>$$>$ 3\mbox{]} \& (0x1 $<$$<$ ((i) \& 7)))}\label{fpool_8c_a282a07460b6404ef56a9f28ccd922ed2}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
tb\-\_\-handle\-\_\-t \hyperlink{fpool_8c_a148708ce2d08adabfe64ca22761d39d4}{tb\-\_\-fpool\-\_\-init} (tb\-\_\-byte\-\_\-t $\ast$data, tb\-\_\-size\-\_\-t size, tb\-\_\-size\-\_\-t step, tb\-\_\-size\-\_\-t align)
\item 
tb\-\_\-void\-\_\-t \hyperlink{fpool_8c_acb2e6619c275bc2ad0112c9c1dccb690}{tb\-\_\-fpool\-\_\-exit} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-void\-\_\-t \hyperlink{fpool_8c_a75c57f0f32f5384c660b33b4ef2fa1ac}{tb\-\_\-fpool\-\_\-clear} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-size\-\_\-t \hyperlink{fpool_8c_ad512f794555e51f515d05e931b46340d}{tb\-\_\-fpool\-\_\-size} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-pointer\-\_\-t \hyperlink{fpool_8c_a73fb908554649e7efbb5be467830f63a}{tb\-\_\-fpool\-\_\-malloc} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-pointer\-\_\-t \hyperlink{fpool_8c_a88fece246356f77a3b5523c162707e33}{tb\-\_\-fpool\-\_\-malloc0} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-pointer\-\_\-t \hyperlink{fpool_8c_a13050e013e3a067e05144808bf1263f0}{tb\-\_\-fpool\-\_\-memdup} (tb\-\_\-handle\-\_\-t handle, tb\-\_\-cpointer\-\_\-t data)
\item 
tb\-\_\-bool\-\_\-t \hyperlink{fpool_8c_ad57ca93f057d7e3cde046df848cefd20}{tb\-\_\-fpool\-\_\-free} (tb\-\_\-handle\-\_\-t handle, tb\-\_\-pointer\-\_\-t data)
\item 
tb\-\_\-void\-\_\-t \hyperlink{fpool_8c_a5a1ce7e289f990438811005d1147c52f}{tb\-\_\-fpool\-\_\-walk} (tb\-\_\-handle\-\_\-t handle, tb\-\_\-bool\-\_\-t($\ast$func)(tb\-\_\-pointer\-\_\-t item, tb\-\_\-pointer\-\_\-t data), tb\-\_\-pointer\-\_\-t data)
\item 
tb\-\_\-void\-\_\-t \hyperlink{fpool_8c_aa0126abf205d3ead50a24b6f4ad7e9c3}{tb\-\_\-fpool\-\_\-dump} (tb\-\_\-handle\-\_\-t handle)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
The Treasure Box Library

T\-Box is free software; you can redistribute it and/or modify it under the terms of the G\-N\-U Lesser General Public License as published by the Free Software Foundation; either version 2.\-1 of the License, or (at your option) any later version.

T\-Box is distributed in the hope that it will be useful, but W\-I\-T\-H\-O\-U\-T A\-N\-Y W\-A\-R\-R\-A\-N\-T\-Y; without even the implied warranty of M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y or F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E. See the G\-N\-U Lesser General Public License for more details.

You should have received a copy of the G\-N\-U Lesser General Public License along with T\-Box; If not, see \href{http://www.gnu.org/licenses/}{\tt http\-://www.\-gnu.\-org/licenses/}

Copyright (C) 2009 -\/ 2015, ruki All rights reserved.

\begin{DoxyAuthor}{Author}
ruki 
\end{DoxyAuthor}


Definition in file \hyperlink{fpool_8c_source}{fpool.\-c}.



\subsection{Function Documentation}
\hypertarget{fpool_8c_a75c57f0f32f5384c660b33b4ef2fa1ac}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-clear@{tb\-\_\-fpool\-\_\-clear}}
\index{tb\-\_\-fpool\-\_\-clear@{tb\-\_\-fpool\-\_\-clear}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-clear}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-fpool\-\_\-clear (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{fpool_8c_a75c57f0f32f5384c660b33b4ef2fa1ac}
clear fixed pool


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
\end{DoxyParams}


Definition at line 341 of file fpool.\-c.



Referenced by tb\-\_\-fpool\-\_\-exit(), and tb\-\_\-rpool\-\_\-clear().

\hypertarget{fpool_8c_aa0126abf205d3ead50a24b6f4ad7e9c3}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-dump@{tb\-\_\-fpool\-\_\-dump}}
\index{tb\-\_\-fpool\-\_\-dump@{tb\-\_\-fpool\-\_\-dump}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-dump}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-fpool\-\_\-dump (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{fpool_8c_aa0126abf205d3ead50a24b6f4ad7e9c3}
dump fixed pool


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
\end{DoxyParams}


Definition at line 522 of file fpool.\-c.



Referenced by tb\-\_\-rpool\-\_\-dump().

\hypertarget{fpool_8c_acb2e6619c275bc2ad0112c9c1dccb690}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-exit@{tb\-\_\-fpool\-\_\-exit}}
\index{tb\-\_\-fpool\-\_\-exit@{tb\-\_\-fpool\-\_\-exit}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-exit}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-fpool\-\_\-exit (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{fpool_8c_acb2e6619c275bc2ad0112c9c1dccb690}
exit fixed pool


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
\end{DoxyParams}


Definition at line 328 of file fpool.\-c.



References tb\-\_\-fpool\-\_\-clear().



Referenced by tb\-\_\-rpool\-\_\-exit(), and tb\-\_\-rpool\-\_\-malloc().

\hypertarget{fpool_8c_ad57ca93f057d7e3cde046df848cefd20}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-free@{tb\-\_\-fpool\-\_\-free}}
\index{tb\-\_\-fpool\-\_\-free@{tb\-\_\-fpool\-\_\-free}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-free}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-bool\-\_\-t tb\-\_\-fpool\-\_\-free (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle, }
\item[{tb\-\_\-pointer\-\_\-t}]{data}
\end{DoxyParamCaption}
)}}\label{fpool_8c_ad57ca93f057d7e3cde046df848cefd20}
free fixed pool data


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
{\em data} & the pool item data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
tb\-\_\-true or tb\-\_\-false 
\end{DoxyReturn}


Definition at line 437 of file fpool.\-c.



Referenced by tb\-\_\-rpool\-\_\-free().

\hypertarget{fpool_8c_a148708ce2d08adabfe64ca22761d39d4}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-init@{tb\-\_\-fpool\-\_\-init}}
\index{tb\-\_\-fpool\-\_\-init@{tb\-\_\-fpool\-\_\-init}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-handle\-\_\-t tb\-\_\-fpool\-\_\-init (
\begin{DoxyParamCaption}
\item[{tb\-\_\-byte\-\_\-t $\ast$}]{data, }
\item[{tb\-\_\-size\-\_\-t}]{size, }
\item[{tb\-\_\-size\-\_\-t}]{step, }
\item[{tb\-\_\-size\-\_\-t}]{align}
\end{DoxyParamCaption}
)}}\label{fpool_8c_a148708ce2d08adabfe64ca22761d39d4}
init fixed pool


\begin{DoxyParams}{Parameters}
{\em data} & the data \\
\hline
{\em size} & the size \\
\hline
{\em step} & the step \\
\hline
{\em align} & the align\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the pool handle 
\end{DoxyReturn}


Definition at line 257 of file fpool.\-c.



Referenced by tb\-\_\-rpool\-\_\-malloc().

\hypertarget{fpool_8c_a73fb908554649e7efbb5be467830f63a}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-malloc@{tb\-\_\-fpool\-\_\-malloc}}
\index{tb\-\_\-fpool\-\_\-malloc@{tb\-\_\-fpool\-\_\-malloc}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-malloc}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-pointer\-\_\-t tb\-\_\-fpool\-\_\-malloc (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{fpool_8c_a73fb908554649e7efbb5be467830f63a}
malloc fixed pool data


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the data pointer 
\end{DoxyReturn}


Definition at line 376 of file fpool.\-c.



Referenced by tb\-\_\-fpool\-\_\-malloc0(), tb\-\_\-fpool\-\_\-memdup(), and tb\-\_\-rpool\-\_\-malloc().

\hypertarget{fpool_8c_a88fece246356f77a3b5523c162707e33}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-malloc0@{tb\-\_\-fpool\-\_\-malloc0}}
\index{tb\-\_\-fpool\-\_\-malloc0@{tb\-\_\-fpool\-\_\-malloc0}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-malloc0}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-pointer\-\_\-t tb\-\_\-fpool\-\_\-malloc0 (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{fpool_8c_a88fece246356f77a3b5523c162707e33}
malloc fixed pool data and clear it


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the data pointer 
\end{DoxyReturn}


Definition at line 406 of file fpool.\-c.



References tb\-\_\-fpool\-\_\-malloc().

\hypertarget{fpool_8c_a13050e013e3a067e05144808bf1263f0}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-memdup@{tb\-\_\-fpool\-\_\-memdup}}
\index{tb\-\_\-fpool\-\_\-memdup@{tb\-\_\-fpool\-\_\-memdup}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-memdup}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-pointer\-\_\-t tb\-\_\-fpool\-\_\-memdup (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle, }
\item[{tb\-\_\-cpointer\-\_\-t}]{data}
\end{DoxyParamCaption}
)}}\label{fpool_8c_a13050e013e3a067e05144808bf1263f0}
duplicate fixed pool data


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
{\em data} & the data pointer\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the duplicated data pointer 
\end{DoxyReturn}


Definition at line 421 of file fpool.\-c.



References tb\-\_\-fpool\-\_\-malloc().

\hypertarget{fpool_8c_ad512f794555e51f515d05e931b46340d}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-size@{tb\-\_\-fpool\-\_\-size}}
\index{tb\-\_\-fpool\-\_\-size@{tb\-\_\-fpool\-\_\-size}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-size\-\_\-t tb\-\_\-fpool\-\_\-size (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{fpool_8c_ad512f794555e51f515d05e931b46340d}
the fixed pool item count


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the item count 
\end{DoxyReturn}


Definition at line 367 of file fpool.\-c.

\hypertarget{fpool_8c_a5a1ce7e289f990438811005d1147c52f}{\index{fpool.\-c@{fpool.\-c}!tb\-\_\-fpool\-\_\-walk@{tb\-\_\-fpool\-\_\-walk}}
\index{tb\-\_\-fpool\-\_\-walk@{tb\-\_\-fpool\-\_\-walk}!fpool.c@{fpool.\-c}}
\subsubsection[{tb\-\_\-fpool\-\_\-walk}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-fpool\-\_\-walk (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle, }
\item[{tb\-\_\-bool\-\_\-t($\ast$)(tb\-\_\-pointer\-\_\-t item, tb\-\_\-pointer\-\_\-t data)}]{func, }
\item[{tb\-\_\-pointer\-\_\-t}]{data}
\end{DoxyParamCaption}
)}}\label{fpool_8c_a5a1ce7e289f990438811005d1147c52f}
walk fixed pool item


\begin{DoxyCode}
tb\_bool\_t tb\_fpool\_item\_func(tb\_pointer\_t item, tb\_pointer\_t data)
\{
        \textcolor{comment}{// is tail?}
        \textcolor{keywordflow}{if} (!item) ;

        \textcolor{comment}{// ok}
        \textcolor{keywordflow}{return} tb\_true;

fail:
        \textcolor{comment}{// break}
        \textcolor{keywordflow}{return} tb\_false;
\}
\end{DoxyCode}



\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
{\em func} & the walk func \\
\hline
{\em data} & the walk data \\
\hline
\end{DoxyParams}


Definition at line 469 of file fpool.\-c.



Referenced by tb\-\_\-rpool\-\_\-walk().

