\hypertarget{vsnprintf_8c}{\section{src/tbox/libc/stdio/vsnprintf.c File Reference}
\label{vsnprintf_8c}\index{src/tbox/libc/stdio/vsnprintf.\-c@{src/tbox/libc/stdio/vsnprintf.\-c}}
}
{\ttfamily \#include \char`\"{}prefix.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}stdio.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../../math/math.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../../libm/libm.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../../utils/utils.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../string/string.\-h\char`\"{}}\\*
Include dependency graph for vsnprintf.\-c\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d34/vsnprintf_8c__incl}
\end{center}
\end{figure}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries tb\-\_\-printf\-\_\-type\-\_\-t} \{ \\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-N\-O\-N\-E} = 0, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-I\-N\-T} = 1, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-C\-H\-A\-R} = 2, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-C\-H\-A\-R\-\_\-\-P\-E\-R\-C\-E\-N\-T} = 3, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-F\-L\-O\-A\-T} = 4, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-D\-O\-U\-B\-L\-E} = 5, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-S\-T\-R\-I\-N\-G} = 6, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-W\-I\-D\-T\-H} = 7, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-P\-R\-E\-C\-I\-S\-I\-O\-N} = 8, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-I\-N\-V\-A\-L\-I\-D} = 9, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-N\-O\-N\-E} = 0, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-I\-N\-T} = 1, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-C\-H\-A\-R} = 2, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-C\-H\-A\-R\-\_\-\-P\-E\-R\-C\-E\-N\-T} = 3, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-F\-L\-O\-A\-T} = 4, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-D\-O\-U\-B\-L\-E} = 5, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-S\-T\-R\-I\-N\-G} = 6, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-W\-I\-D\-T\-H} = 7, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-P\-R\-E\-C\-I\-S\-I\-O\-N} = 8, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-T\-Y\-P\-E\-\_\-\-I\-N\-V\-A\-L\-I\-D} = 9
 \}
\item 
enum {\bfseries tb\-\_\-printf\-\_\-extra\-\_\-t} \{ \\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-N\-O\-N\-E} = 0, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-S\-I\-G\-N\-E\-D} = 1, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-U\-P\-P\-E\-R} = 2, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-P\-E\-R\-C\-E\-N\-T} = 4, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-E\-X\-P} = 8, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-N\-O\-N\-E} = 0, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-S\-I\-G\-N\-E\-D} = 1, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-U\-P\-P\-E\-R} = 2, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-P\-E\-R\-C\-E\-N\-T} = 4, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-E\-X\-T\-R\-A\-\_\-\-E\-X\-P} = 8
 \}
\item 
enum {\bfseries tb\-\_\-printf\-\_\-qual\-\_\-t} \{ \\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-N\-O\-N\-E} = 0, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-H} = 1, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-L} = 2, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-L\-L} = 3, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-I8} = 4, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-I16} = 5, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-I32} = 6, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-I64} = 7, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-N\-O\-N\-E} = 0, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-H} = 1, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-L} = 2, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-L\-L} = 3, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-I8} = 4, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-I16} = 5, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-I32} = 6, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-Q\-U\-A\-L\-\_\-\-I64} = 7
 \}
\item 
enum {\bfseries tb\-\_\-printf\-\_\-flag\-\_\-t} \{ \\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-N\-O\-N\-E} = 0, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-P\-L\-U\-S} = 1, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-L\-E\-F\-T} = 2, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-Z\-E\-R\-O} = 4, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-P\-F\-I\-X} = 8, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-N\-O\-N\-E} = 0, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-P\-L\-U\-S} = 1, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-L\-E\-F\-T} = 2, 
\\*
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-Z\-E\-R\-O} = 4, 
{\bfseries T\-B\-\_\-\-P\-R\-I\-N\-T\-F\-\_\-\-F\-L\-A\-G\-\_\-\-P\-F\-I\-X} = 8
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
tb\-\_\-long\-\_\-t \hyperlink{vsnprintf_8c_a0974710b89a0ceca9b51c7d8a681b2c3}{tb\-\_\-vsnprintf} (tb\-\_\-char\-\_\-t $\ast$s, tb\-\_\-size\-\_\-t n, tb\-\_\-char\-\_\-t const $\ast$fmt, tb\-\_\-va\-\_\-list\-\_\-t args)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
The Treasure Box Library

T\-Box is free software; you can redistribute it and/or modify it under the terms of the G\-N\-U Lesser General Public License as published by the Free Software Foundation; either version 2.\-1 of the License, or (at your option) any later version.

T\-Box is distributed in the hope that it will be useful, but W\-I\-T\-H\-O\-U\-T A\-N\-Y W\-A\-R\-R\-A\-N\-T\-Y; without even the implied warranty of M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y or F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E. See the G\-N\-U Lesser General Public License for more details.

You should have received a copy of the G\-N\-U Lesser General Public License along with T\-Box; If not, see \href{http://www.gnu.org/licenses/}{\tt http\-://www.\-gnu.\-org/licenses/}

Copyright (C) 2009 -\/ 2015, ruki All rights reserved.

\begin{DoxyAuthor}{Author}
ruki 
\end{DoxyAuthor}


Definition in file \hyperlink{vsnprintf_8c_source}{vsnprintf.\-c}.



\subsection{Function Documentation}
\hypertarget{vsnprintf_8c_a0974710b89a0ceca9b51c7d8a681b2c3}{\index{vsnprintf.\-c@{vsnprintf.\-c}!tb\-\_\-vsnprintf@{tb\-\_\-vsnprintf}}
\index{tb\-\_\-vsnprintf@{tb\-\_\-vsnprintf}!vsnprintf.c@{vsnprintf.\-c}}
\subsubsection[{tb\-\_\-vsnprintf}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-long\-\_\-t tb\-\_\-vsnprintf (
\begin{DoxyParamCaption}
\item[{tb\-\_\-char\-\_\-t $\ast$}]{s, }
\item[{tb\-\_\-size\-\_\-t}]{n, }
\item[{tb\-\_\-char\-\_\-t const $\ast$}]{fmt, }
\item[{tb\-\_\-va\-\_\-list\-\_\-t}]{args}
\end{DoxyParamCaption}
)}}\label{vsnprintf_8c_a0974710b89a0ceca9b51c7d8a681b2c3}
format a string and place it in a buffer


\begin{DoxyParams}{Parameters}
{\em s} & the buffer to place the result into \\
\hline
{\em n} & the size of the buffer, including the trailing null space \\
\hline
{\em fmt} & the format string to use \\
\hline
{\em args} & arguments for the format string\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of characters which would be generated for the given input, excluding the trailing '\textbackslash{}0'.
\end{DoxyReturn}

\begin{DoxyItemize}
\item format\-: \%\mbox{[}flags\mbox{]}\mbox{[}width\mbox{]}\mbox{[}.precision\mbox{]}\mbox{[}qualifier\mbox{]}type
\item flags\-:
\begin{DoxyItemize}
\item default\-: right-\/justified, left-\/pad the output with spaces until the required length of output is attained. If combined with '0' (see below), it will cause the sign to become a space when positive, but the remaining characters will be zero-\/padded
\item -\/\-: left-\/justified, e.\-g. \%-\/d
\item +\-: denote the sign '+' or '-\/' of a number
\item 0\-: use 0 instead of spaces to left-\/fill a fixed-\/length field
\item \#\-: add prefix or suffix
\begin{DoxyItemize}
\item \%\#o =$>$ add prefix\-: 0...
\item \%\#x =$>$ add prefix\-: 0x...
\item \%\#\-X =$>$ add prefix\-: 0\-X...
\item \%\#b =$>$ add prefix\-: 0b...
\item \%\#\-B =$>$ add prefix\-: 0\-B...
\item \%\#f =$>$ add prefix\-: 0f...
\item \%\#\-F =$>$ add prefix\-: 0\-F...
\end{DoxyItemize}
\end{DoxyItemize}
\item width\-:
\begin{DoxyItemize}
\item n\-: n = 1, 2, 3, ..., fill spaces
\item 0n\-: n = 1, 2, 3, ..., fill 0
\item $\ast$\-: causes printf to pad the output until it is n characters wide, where n is an integer value stored in the a function argument just preceding that represented by the modified type. e.\-g. printf(\char`\"{}\%$\ast$d\char`\"{}, 5, 10) will result in \char`\"{}10\char`\"{} being printed with a width of 5.
\end{DoxyItemize}
\item .precision\-:
\begin{DoxyItemize}
\item .n\-: for non-\/integral numeric types, causes the decimal portion of the output to be expressed in at least number digits. for the string type, causes the output to be truncated at number characters. if the precision is zero, nothing is printed for the corresponding argument.
\item $\ast$\-: same as the above, but uses an integer value in the intaken argument to determine the number of decimal places or maximum string length. e.\-g. printf(\char`\"{}\%.$\ast$s\char`\"{}, 3, \char`\"{}abcdef\char`\"{}) will result in \char`\"{}abc\char`\"{} being printed.
\end{DoxyItemize}
\item qualifier\-:
\begin{DoxyItemize}
\item h\-: short integer or single double-\/point
\item l\-: long integer or double double-\/point
\item I8\-: 8-\/bit integer
\item I16\-: 16-\/bit integer
\item I32\-: 32-\/bit integer
\item I64/ll\-: 64-\/bit integer
\end{DoxyItemize}
\end{DoxyItemize}

\begin{DoxyNote}{Note}
support h, l, I8, I16, I32, I64, ll
\end{DoxyNote}

\begin{DoxyItemize}
\item type(e.\-g. d x u \%\% ...)\-:
\begin{DoxyItemize}
\item d, i\-: print an int as a signed decimal number. 'd' and 'i' are synonymous for output, but are different when used with scanf() for input.
\item u\-: print decimal unsigned int.
\item o\-: print an unsigned int in octal.
\item x/\-X\-: print an unsigned int as a hexadecimal number. 'x' uses lower-\/case letters and 'X' uses upper-\/case.
\item b/\-B\-: print an unsigned binary interger
\item e/\-E\-: print a double value in standard form (\mbox{[}-\/\mbox{]}d.\-ddd e\mbox{[}+/-\/\mbox{]}ddd). An E conversion uses the letter E (rather than e) to introduce the exponent. The exponent always contains at least two digits; if the value is zero, the exponent is 00. e.\-g. 3.\-141593e+00
\item f/\-F\-: Print a double in normal (fixed-\/point) notation. 'f' and 'F' only differs in how the strings for an infinite number or Na\-N are printed ('inf', 'infinity' and 'nan' for 'f', 'I\-N\-F', 'I\-N\-F\-I\-N\-I\-T\-Y' and 'N\-A\-N' for 'F').
\item g/\-G\-: print a double in either normal or exponential notation, whichever is more appropriate for its magnitude. 'g' uses lower-\/case letters, 'G' uses upper-\/case letters. This type differs slightly from fixed-\/point notation in that insignificant zeroes to the right of the decimal point are not included. Also, the decimal point is not included on whole numbers.
\item c\-: print a char (character).
\item s\-: print a character string
\item p\-: print a void $\ast$ (pointer to void) in an implementation-\/defined format.
\item n\-: print nothing, but write number of characters successfully written so far into an integer pointer parameter.
\item \%\-: \%
\end{DoxyItemize}
\end{DoxyItemize}

\begin{DoxyNote}{Note}
support d, i, u, o, u, x/\-X, b/\-B, f/\-F, c, s 

not support e/\-E, g/\-G, p, n
\end{DoxyNote}
e.\-g. 
\begin{DoxyCode}
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|hello world|\(\backslash\)n"});
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%-10s|%%|%10s|\(\backslash\)n"}, \textcolor{stringliteral}{"hello"}, \textcolor{stringliteral}{"world"});
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%#2c|%2.5c|%*c|\(\backslash\)n"}, \textcolor{charliteral}{'A'}, \textcolor{charliteral}{'B'}, 5, \textcolor{charliteral}{'C'});
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%#2d|%#8.3o|%*.*d|\(\backslash\)n"}, -56, 56, 10, 5, 56);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%#-8.5x|%#2.9X|\(\backslash\)n"}, 0x1f, 0x1f);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%#-8.5b|%#2.9B|\(\backslash\)n"}, 0x1f, 0x1f);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%-6Id|%5I8u|%#I64x|%#llx|\(\backslash\)n"}, 256, 255, (tb\_int64\_t)0x8fffffffffff, (tb\_int64\_t)0
      x8fffffffffff);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%lf|\(\backslash\)n"}, -3.1415926535897932384626433832795);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%lf|%lf|%lf|\(\backslash\)n"}, 3.14, 0, -0);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%0.9f|\(\backslash\)n"}, 3.1415926535897932384626433832795);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%16.9f|\(\backslash\)n"}, 3.1415926535897932384626433832795);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%016.9f|\(\backslash\)n"}, 3.14159);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%lf|\(\backslash\)n"}, 1.0 / 6.0);
\hyperlink{printf_8c_a31b172721cbec21fe229689455f483e4}{tb\_printf}(\textcolor{stringliteral}{"|%lf|\(\backslash\)n"}, 0.0003141596);
\end{DoxyCode}
 

Definition at line 1000 of file vsnprintf.\-c.



Referenced by tb\-\_\-trace\-\_\-done\-\_\-with\-\_\-args(), and tb\-\_\-trace\-\_\-tail().

