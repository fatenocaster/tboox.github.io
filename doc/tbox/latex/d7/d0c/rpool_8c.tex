\hypertarget{rpool_8c}{\section{src/memory/rpool.c File Reference}
\label{rpool_8c}\index{src/memory/rpool.\-c@{src/memory/rpool.\-c}}
}
{\ttfamily \#include \char`\"{}rpool.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}fpool.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}malloc.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../libc/libc.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../math/math.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../utils/utils.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../platform/platform.\-h\char`\"{}}\\*
Include dependency graph for rpool.\-c\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dd/de8/rpool_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{rpool_8c_a2c4265c49c6e59cc67577aa9632ea488}{\#define {\bfseries T\-B\-\_\-\-R\-P\-O\-O\-L\-\_\-\-C\-H\-U\-N\-K\-\_\-\-G\-R\-O\-W}~(8)}\label{rpool_8c_a2c4265c49c6e59cc67577aa9632ea488}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
tb\-\_\-handle\-\_\-t \hyperlink{rpool_8c_aef3358e4114047a71f76c6ca46e8e517}{tb\-\_\-rpool\-\_\-init} (tb\-\_\-size\-\_\-t grow, tb\-\_\-size\-\_\-t step, tb\-\_\-size\-\_\-t align)
\item 
tb\-\_\-void\-\_\-t \hyperlink{rpool_8c_ae8786c1c3b006fb8621c2be3e4354fb5}{tb\-\_\-rpool\-\_\-exit} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-void\-\_\-t \hyperlink{rpool_8c_af48ad09024f85113666433a019de89dd}{tb\-\_\-rpool\-\_\-clear} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-size\-\_\-t \hyperlink{rpool_8c_a06bae22e4ee2b5ec7879c172d0bd45fb}{tb\-\_\-rpool\-\_\-size} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-pointer\-\_\-t \hyperlink{rpool_8c_a12e70b59a3fef8ec68aa2bbef55d3e5c}{tb\-\_\-rpool\-\_\-malloc} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-pointer\-\_\-t \hyperlink{rpool_8c_abfa9196993ecafd43807e4529e6b7cd1}{tb\-\_\-rpool\-\_\-malloc0} (tb\-\_\-handle\-\_\-t handle)
\item 
tb\-\_\-bool\-\_\-t \hyperlink{rpool_8c_a7c65cfaee33ebc29f29df66560bca7a7}{tb\-\_\-rpool\-\_\-free} (tb\-\_\-handle\-\_\-t handle, tb\-\_\-pointer\-\_\-t data)
\item 
tb\-\_\-pointer\-\_\-t \hyperlink{rpool_8c_aff02d3dbbf70565379356ec572a86ff5}{tb\-\_\-rpool\-\_\-memdup} (tb\-\_\-handle\-\_\-t handle, tb\-\_\-cpointer\-\_\-t data)
\item 
tb\-\_\-void\-\_\-t \hyperlink{rpool_8c_ad1c7530b06937639f22b0830d9111e65}{tb\-\_\-rpool\-\_\-walk} (tb\-\_\-handle\-\_\-t handle, tb\-\_\-bool\-\_\-t($\ast$func)(tb\-\_\-pointer\-\_\-t item, tb\-\_\-pointer\-\_\-t data), tb\-\_\-pointer\-\_\-t data)
\item 
tb\-\_\-void\-\_\-t \hyperlink{rpool_8c_a45770b16c79c9e8ea811b4cf44cb4bbe}{tb\-\_\-rpool\-\_\-dump} (tb\-\_\-handle\-\_\-t handle)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
The Treasure Box Library

T\-Box is free software; you can redistribute it and/or modify it under the terms of the G\-N\-U Lesser General Public License as published by the Free Software Foundation; either version 2.\-1 of the License, or (at your option) any later version.

T\-Box is distributed in the hope that it will be useful, but W\-I\-T\-H\-O\-U\-T A\-N\-Y W\-A\-R\-R\-A\-N\-T\-Y; without even the implied warranty of M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y or F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E. See the G\-N\-U Lesser General Public License for more details.

You should have received a copy of the G\-N\-U Lesser General Public License along with T\-Box; If not, see \href{http://www.gnu.org/licenses/}{\tt http\-://www.\-gnu.\-org/licenses/}

Copyright (C) 2009 -\/ 2015, ruki All rights reserved.

\begin{DoxyAuthor}{Author}
ruki 
\end{DoxyAuthor}


Definition in file \hyperlink{rpool_8c_source}{rpool.\-c}.



\subsection{Function Documentation}
\hypertarget{rpool_8c_af48ad09024f85113666433a019de89dd}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-clear@{tb\-\_\-rpool\-\_\-clear}}
\index{tb\-\_\-rpool\-\_\-clear@{tb\-\_\-rpool\-\_\-clear}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-clear}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-rpool\-\_\-clear (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{rpool_8c_af48ad09024f85113666433a019de89dd}
clear regular pool


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
\end{DoxyParams}


Definition at line 206 of file rpool.\-c.



References tb\-\_\-fpool\-\_\-clear().



Referenced by tb\-\_\-aiop\-\_\-cler(), tb\-\_\-dlist\-\_\-clear(), tb\-\_\-ltimer\-\_\-clear(), tb\-\_\-rpool\-\_\-exit(), tb\-\_\-slist\-\_\-clear(), and tb\-\_\-timer\-\_\-clear().

\hypertarget{rpool_8c_a45770b16c79c9e8ea811b4cf44cb4bbe}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-dump@{tb\-\_\-rpool\-\_\-dump}}
\index{tb\-\_\-rpool\-\_\-dump@{tb\-\_\-rpool\-\_\-dump}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-dump}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-rpool\-\_\-dump (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{rpool_8c_a45770b16c79c9e8ea811b4cf44cb4bbe}
dump regular pool


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
\end{DoxyParams}


Definition at line 484 of file rpool.\-c.



References tb\-\_\-fpool\-\_\-dump().

\hypertarget{rpool_8c_ae8786c1c3b006fb8621c2be3e4354fb5}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-exit@{tb\-\_\-rpool\-\_\-exit}}
\index{tb\-\_\-rpool\-\_\-exit@{tb\-\_\-rpool\-\_\-exit}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-exit}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-rpool\-\_\-exit (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{rpool_8c_ae8786c1c3b006fb8621c2be3e4354fb5}
exit regular pool


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
\end{DoxyParams}


Definition at line 177 of file rpool.\-c.



References tb\-\_\-fpool\-\_\-exit(), and tb\-\_\-rpool\-\_\-clear().



Referenced by tb\-\_\-aicp\-\_\-exit(), tb\-\_\-aiop\-\_\-exit(), tb\-\_\-dlist\-\_\-exit(), tb\-\_\-ltimer\-\_\-exit(), tb\-\_\-mstream\-\_\-exit(), tb\-\_\-rpool\-\_\-init(), tb\-\_\-slist\-\_\-exit(), and tb\-\_\-timer\-\_\-exit().

\hypertarget{rpool_8c_a7c65cfaee33ebc29f29df66560bca7a7}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-free@{tb\-\_\-rpool\-\_\-free}}
\index{tb\-\_\-rpool\-\_\-free@{tb\-\_\-rpool\-\_\-free}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-free}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-bool\-\_\-t tb\-\_\-rpool\-\_\-free (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle, }
\item[{tb\-\_\-pointer\-\_\-t}]{data}
\end{DoxyParamCaption}
)}}\label{rpool_8c_a7c65cfaee33ebc29f29df66560bca7a7}
free regular pool data


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
{\em data} & the pool item data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
tb\-\_\-true or tb\-\_\-false 
\end{DoxyReturn}


Definition at line 381 of file rpool.\-c.



References tb\-\_\-fpool\-\_\-free().



Referenced by tb\-\_\-dlist\-\_\-remove(), tb\-\_\-dlist\-\_\-walk(), tb\-\_\-ltimer\-\_\-task\-\_\-add\-\_\-at(), tb\-\_\-ltimer\-\_\-task\-\_\-del(), tb\-\_\-ltimer\-\_\-task\-\_\-run\-\_\-at(), tb\-\_\-slist\-\_\-remove\-\_\-next(), tb\-\_\-slist\-\_\-walk(), tb\-\_\-timer\-\_\-spak(), and tb\-\_\-timer\-\_\-task\-\_\-del().

\hypertarget{rpool_8c_aef3358e4114047a71f76c6ca46e8e517}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-init@{tb\-\_\-rpool\-\_\-init}}
\index{tb\-\_\-rpool\-\_\-init@{tb\-\_\-rpool\-\_\-init}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-handle\-\_\-t tb\-\_\-rpool\-\_\-init (
\begin{DoxyParamCaption}
\item[{tb\-\_\-size\-\_\-t}]{grow, }
\item[{tb\-\_\-size\-\_\-t}]{step, }
\item[{tb\-\_\-size\-\_\-t}]{align}
\end{DoxyParamCaption}
)}}\label{rpool_8c_aef3358e4114047a71f76c6ca46e8e517}
init regular pool


\begin{DoxyParams}{Parameters}
{\em grow} & the grow \\
\hline
{\em step} & the step \\
\hline
{\em align} & the align\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the pool handle 
\end{DoxyReturn}


Definition at line 133 of file rpool.\-c.



References tb\-\_\-rpool\-\_\-exit().



Referenced by tb\-\_\-aicp\-\_\-init(), tb\-\_\-aiop\-\_\-init(), tb\-\_\-dlist\-\_\-init(), tb\-\_\-ltimer\-\_\-init(), tb\-\_\-mstream\-\_\-init(), tb\-\_\-slist\-\_\-init(), and tb\-\_\-timer\-\_\-init().

\hypertarget{rpool_8c_a12e70b59a3fef8ec68aa2bbef55d3e5c}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-malloc@{tb\-\_\-rpool\-\_\-malloc}}
\index{tb\-\_\-rpool\-\_\-malloc@{tb\-\_\-rpool\-\_\-malloc}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-malloc}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-pointer\-\_\-t tb\-\_\-rpool\-\_\-malloc (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{rpool_8c_a12e70b59a3fef8ec68aa2bbef55d3e5c}
malloc regular pool data


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the data pointer 
\end{DoxyReturn}


Definition at line 245 of file rpool.\-c.



References tb\-\_\-fpool\-\_\-exit(), tb\-\_\-fpool\-\_\-init(), and tb\-\_\-fpool\-\_\-malloc().



Referenced by tb\-\_\-dlist\-\_\-insert\-\_\-prev(), tb\-\_\-rpool\-\_\-malloc0(), tb\-\_\-rpool\-\_\-memdup(), and tb\-\_\-slist\-\_\-insert\-\_\-next().

\hypertarget{rpool_8c_abfa9196993ecafd43807e4529e6b7cd1}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-malloc0@{tb\-\_\-rpool\-\_\-malloc0}}
\index{tb\-\_\-rpool\-\_\-malloc0@{tb\-\_\-rpool\-\_\-malloc0}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-malloc0}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-pointer\-\_\-t tb\-\_\-rpool\-\_\-malloc0 (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{rpool_8c_abfa9196993ecafd43807e4529e6b7cd1}
malloc regular pool data and clear it


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the data pointer 
\end{DoxyReturn}


Definition at line 365 of file rpool.\-c.



References tb\-\_\-rpool\-\_\-malloc().



Referenced by tb\-\_\-ltimer\-\_\-task\-\_\-add\-\_\-at(), tb\-\_\-ltimer\-\_\-task\-\_\-run\-\_\-at(), tb\-\_\-mstream\-\_\-done(), tb\-\_\-timer\-\_\-task\-\_\-add\-\_\-at(), and tb\-\_\-timer\-\_\-task\-\_\-run\-\_\-at().

\hypertarget{rpool_8c_aff02d3dbbf70565379356ec572a86ff5}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-memdup@{tb\-\_\-rpool\-\_\-memdup}}
\index{tb\-\_\-rpool\-\_\-memdup@{tb\-\_\-rpool\-\_\-memdup}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-memdup}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-pointer\-\_\-t tb\-\_\-rpool\-\_\-memdup (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle, }
\item[{tb\-\_\-cpointer\-\_\-t}]{data}
\end{DoxyParamCaption}
)}}\label{rpool_8c_aff02d3dbbf70565379356ec572a86ff5}
duplicate regular pool data


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
{\em data} & the data pointer\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the duplicated data pointer 
\end{DoxyReturn}


Definition at line 441 of file rpool.\-c.



References tb\-\_\-rpool\-\_\-malloc().

\hypertarget{rpool_8c_a06bae22e4ee2b5ec7879c172d0bd45fb}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-size@{tb\-\_\-rpool\-\_\-size}}
\index{tb\-\_\-rpool\-\_\-size@{tb\-\_\-rpool\-\_\-size}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-size\-\_\-t tb\-\_\-rpool\-\_\-size (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle}
\end{DoxyParamCaption}
)}}\label{rpool_8c_a06bae22e4ee2b5ec7879c172d0bd45fb}
the regular pool item count


\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the item count 
\end{DoxyReturn}


Definition at line 237 of file rpool.\-c.



Referenced by tb\-\_\-dlist\-\_\-size(), tb\-\_\-ltimer\-\_\-spak(), tb\-\_\-mstream\-\_\-size(), and tb\-\_\-slist\-\_\-size().

\hypertarget{rpool_8c_ad1c7530b06937639f22b0830d9111e65}{\index{rpool.\-c@{rpool.\-c}!tb\-\_\-rpool\-\_\-walk@{tb\-\_\-rpool\-\_\-walk}}
\index{tb\-\_\-rpool\-\_\-walk@{tb\-\_\-rpool\-\_\-walk}!rpool.c@{rpool.\-c}}
\subsubsection[{tb\-\_\-rpool\-\_\-walk}]{\setlength{\rightskip}{0pt plus 5cm}tb\-\_\-void\-\_\-t tb\-\_\-rpool\-\_\-walk (
\begin{DoxyParamCaption}
\item[{tb\-\_\-handle\-\_\-t}]{handle, }
\item[{tb\-\_\-bool\-\_\-t($\ast$)(tb\-\_\-pointer\-\_\-t item, tb\-\_\-pointer\-\_\-t data)}]{func, }
\item[{tb\-\_\-pointer\-\_\-t}]{data}
\end{DoxyParamCaption}
)}}\label{rpool_8c_ad1c7530b06937639f22b0830d9111e65}
walk regular pool item


\begin{DoxyCode}
tb\_bool\_t tb\_rpool\_item\_func(tb\_pointer\_t item, tb\_pointer\_t data)
\{
        \textcolor{comment}{// is tail?}
        \textcolor{keywordflow}{if} (!item) ;

        \textcolor{comment}{// ok}
        \textcolor{keywordflow}{return} tb\_true;

fail:
        \textcolor{comment}{// break}
        \textcolor{keywordflow}{return} tb\_false;
\}
\end{DoxyCode}



\begin{DoxyParams}{Parameters}
{\em handle} & the pool handle \\
\hline
{\em func} & the walk func \\
\hline
{\em data} & the walk data \\
\hline
\end{DoxyParams}


Definition at line 457 of file rpool.\-c.



References tb\-\_\-fpool\-\_\-walk().

